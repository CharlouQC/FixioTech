trigger:
  branches:
    include:
      - main
      - master

pr:
  branches:
    include:
      - main
      - master

pool:
  vmImage: ubuntu-latest

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "20.x"
    displayName: "Use Node.js 20"

  # ---- Frontend ----
  - script: |
      cd frontend
      npm ci
    displayName: "Install frontend deps"

  - script: |
      cd frontend
      npm test -- --watch=false
    displayName: "Run frontend tests"

  - script: |
      cd frontend
      npm run build
    displayName: "Build frontend"

  # ---- Backend ----
  - script: |
      cd backend
      npm ci
    displayName: "Install backend deps"

  - script: |
      cd backend
      npm test
    displayName: "Run backend tests"

  - script: |
      cd backend
      npm run build
    displayName: "Build backend"
