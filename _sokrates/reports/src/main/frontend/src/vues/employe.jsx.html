<html>
<head>
    <title>frontend\src\vues\employe.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">frontend\src\vues\employe.jsx (<b>262</b> lines of code) (<a href="employe.jsx">raw</a>):</h3>
<div id="editor">import React, { useEffect, useMemo, useState } from &quot;react&quot;;
import &quot;./employe.css&quot;;
import { useAuth } from &quot;../context/AuthContext&quot;;
import { getRendezVous } from &quot;../../services/apiRendezVous&quot;;

const mapDbStatutToUi = (db) =&gt; {
  // DB: 'Programm&eacute;' | 'Annul&eacute;' | 'Termin&eacute;'
  // UI (classes CSS existantes): en_attente | en_cours | traitee
  if (!db) return &quot;en_attente&quot;;
  const s = db.toLowerCase();
  if (s === &quot;termin&eacute;&quot; || s === &quot;termine&quot;) return &quot;traitee&quot;;
  if (s === &quot;programm&eacute;&quot; || s === &quot;programme&quot;) return &quot;en_attente&quot;;
  if (s === &quot;annul&eacute;&quot; || s === &quot;annule&quot;) return &quot;en_cours&quot;; // fallback visuel neutre
  return &quot;en_attente&quot;;
};

const getStatutBadge = (ui) =&gt; {
  // ui &isin; { en_attente, en_cours, traitee }
  const badges = {
    en_attente: { classe: &quot;statut-attente&quot;, texte: &quot;En attente&quot; },
    en_cours: { classe: &quot;statut-encours&quot;, texte: &quot;En cours&quot; },
    traitee: { classe: &quot;statut-traitee&quot;, texte: &quot;Trait&eacute;e&quot; },
  };
  return badges[ui] || badges.en_attente;
};

const getStatutIcon = (ui) =&gt; {
  const icons = {
    en_attente: &quot;‚è±Ô∏è&quot;,
    en_cours: &quot;üîß&quot;,
    traitee: &quot;‚úÖ&quot;,
  };
  return icons[ui] || &quot;üìã&quot;;
};

const Employe = () =&gt; {
  const { user, role } = useAuth();

  const [loading, setLoading] = useState(true);
  const [rdvs, setRdvs] = useState([]);
  const [error, setError] = useState(&quot;&quot;);

  const [filtreStatut, setFiltreStatut] = useState(&quot;tous&quot;);

  useEffect(() =&gt; {
    if (!user?.id) {
      setLoading(false);
      setError(&quot;Vous devez &ecirc;tre connect&eacute; pour voir vos demandes.&quot;);
      return;
    }
    if (role !== &quot;employe&quot;) {
      setLoading(false);
      setError(&quot;Cette page est r&eacute;serv&eacute;e aux techniciens.&quot;);
      return;
    }

    let alive = true;
    setLoading(true);
    setError(&quot;&quot;);

    (async () =&gt; {
      try {
        // R&eacute;cup&egrave;re uniquement les RDV assign&eacute;s &agrave; cet employ&eacute;
        const list = await getRendezVous({ employe_id: user.id });
        // Tri: plus r&eacute;cents en haut
        (list || []).sort((a, b) =&gt; {
          const ak = `${a.date_rdv} ${a.heure_rdv || &quot;&quot;}`;
          const bk = `${b.date_rdv} ${b.heure_rdv || &quot;&quot;}`;
          return bk.localeCompare(ak);
        });
        if (!alive) return;
        setRdvs(list || []);
      } catch (err) {
        if (!alive) return;
        setError(err?.message || &quot;Erreur lors du chargement des demandes.&quot;);
      } finally {
        if (alive) setLoading(false);
      }
    })();

    return () =&gt; {
      alive = false;
    };
  }, [user, role]);

  const demandes = useMemo(() =&gt; {
    // Adapte chaque RDV aux champs attendus par le rendu existant
    return (rdvs || []).map((r) =&gt; {
      const ui = mapDbStatutToUi(r.statut || &quot;Programm&eacute;&quot;);
      return {
        id: r.id,
        // On n&rsquo;a pas le d&eacute;tail client (nom/email) c&ocirc;t&eacute; RDV &rarr; on affiche un identifiant simple.
        client: {
          nom: `Client #${r.client_id}`,
          courriel: &quot;&quot;,
        },
        service: r.service || &quot;Support technique&quot;, // champ &ldquo;service&rdquo; non stock&eacute; en DB : valeur par d&eacute;faut
        technicien: `Vous (#${r.employe_id})`,
        date: r.date_rdv, // &quot;YYYY-MM-DD&quot;
        heure: r.heure_rdv || &quot;&mdash;&quot;, // &quot;HH:mm&quot;
        description: r.description_probleme || &quot;&mdash;&quot;,
        statut: ui, // pour les badges CSS existants
        dateCreation: r.created_at || r.date_rdv || &quot;&quot;, // fallback si pas de timestamp
      };
    });
  }, [rdvs]);

  const demandesFiltrees = useMemo(() =&gt; {
    if (filtreStatut === &quot;tous&quot;) return demandes;
    return demandes.filter((d) =&gt; d.statut === filtreStatut);
  }, [demandes, filtreStatut]);

  const countBy = (ui) =&gt; demandes.filter((d) =&gt; d.statut === ui).length;

  return (
    &lt;div className=&quot;employe-container&quot;&gt;
      &lt;div className=&quot;employe-header&quot;&gt;
        &lt;h1&gt;Espace Employ&eacute;&lt;/h1&gt;
        &lt;p className=&quot;employe-intro&quot;&gt;
          G&eacute;rez les demandes de support qui vous sont assign&eacute;es.
        &lt;/p&gt;
      &lt;/div&gt;

      {/* Statistiques */}
      &lt;div className=&quot;stats-container&quot;&gt;
        &lt;div className=&quot;stat-card&quot;&gt;
          &lt;div className=&quot;stat-icon&quot;&gt;‚è±Ô∏è&lt;/div&gt;
          &lt;div className=&quot;stat-info&quot;&gt;
            &lt;span className=&quot;stat-nombre&quot;&gt;{countBy(&quot;en_attente&quot;)}&lt;/span&gt;
            &lt;span className=&quot;stat-label&quot;&gt;En attente&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;stat-card&quot;&gt;
          &lt;div className=&quot;stat-icon&quot;&gt;üîß&lt;/div&gt;
          &lt;div className=&quot;stat-info&quot;&gt;
            &lt;span className=&quot;stat-nombre&quot;&gt;{countBy(&quot;en_cours&quot;)}&lt;/span&gt;
            &lt;span className=&quot;stat-label&quot;&gt;En cours&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;stat-card&quot;&gt;
          &lt;div className=&quot;stat-icon&quot;&gt;‚úÖ&lt;/div&gt;
          &lt;div className=&quot;stat-info&quot;&gt;
            &lt;span className=&quot;stat-nombre&quot;&gt;{countBy(&quot;traitee&quot;)}&lt;/span&gt;
            &lt;span className=&quot;stat-label&quot;&gt;Trait&eacute;es&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div className=&quot;stat-card total&quot;&gt;
          &lt;div className=&quot;stat-icon&quot;&gt;üìä&lt;/div&gt;
          &lt;div className=&quot;stat-info&quot;&gt;
            &lt;span className=&quot;stat-nombre&quot;&gt;{demandes.length}&lt;/span&gt;
            &lt;span className=&quot;stat-label&quot;&gt;Total&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {/* Filtres */}
      &lt;div className=&quot;filtres-container&quot;&gt;
        &lt;div className=&quot;filtres-groupe&quot;&gt;
          &lt;button
            className={`filtre-btn ${filtreStatut === &quot;tous&quot; ? &quot;active&quot; : &quot;&quot;}`}
            onClick={() =&gt; setFiltreStatut(&quot;tous&quot;)}
          &gt;
            Toutes ({demandes.length})
          &lt;/button&gt;
          &lt;button
            className={`filtre-btn ${
              filtreStatut === &quot;en_attente&quot; ? &quot;active&quot; : &quot;&quot;
            }`}
            onClick={() =&gt; setFiltreStatut(&quot;en_attente&quot;)}
          &gt;
            En attente ({countBy(&quot;en_attente&quot;)})
          &lt;/button&gt;
          &lt;button
            className={`filtre-btn ${
              filtreStatut === &quot;en_cours&quot; ? &quot;active&quot; : &quot;&quot;
            }`}
            onClick={() =&gt; setFiltreStatut(&quot;en_cours&quot;)}
          &gt;
            En cours ({countBy(&quot;en_cours&quot;)})
          &lt;/button&gt;
          &lt;button
            className={`filtre-btn ${
              filtreStatut === &quot;traitee&quot; ? &quot;active&quot; : &quot;&quot;
            }`}
            onClick={() =&gt; setFiltreStatut(&quot;traitee&quot;)}
          &gt;
            Trait&eacute;es ({countBy(&quot;traitee&quot;)})
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {/* Liste des demandes */}
      &lt;div className=&quot;demandes-container&quot;&gt;
        {loading ? (
          &lt;div className=&quot;aucune-demande&quot;&gt;
            &lt;div className=&quot;aucune-demande-icon&quot;&gt;‚è≥&lt;/div&gt;
            &lt;h2&gt;Chargement de vos demandes&hellip;&lt;/h2&gt;
          &lt;/div&gt;
        ) : error ? (
          &lt;div className=&quot;aucune-demande&quot;&gt;
            &lt;div className=&quot;aucune-demande-icon&quot;&gt;‚ö†Ô∏è&lt;/div&gt;
            &lt;h2&gt;{error}&lt;/h2&gt;
          &lt;/div&gt;
        ) : demandesFiltrees.length === 0 ? (
          &lt;div className=&quot;aucune-demande&quot;&gt;
            &lt;div className=&quot;aucune-demande-icon&quot;&gt;üì≠&lt;/div&gt;
            &lt;h2&gt;Aucune demande pour ce filtre&lt;/h2&gt;
            &lt;p&gt;Les nouvelles demandes appara&icirc;tront ici.&lt;/p&gt;
          &lt;/div&gt;
        ) : (
          &lt;div className=&quot;demandes-liste&quot;&gt;
            {demandesFiltrees.map((demande) =&gt; {
              const badge = getStatutBadge(demande.statut);
              return (
                &lt;div key={demande.id} className=&quot;demande-card&quot;&gt;
                  &lt;div className=&quot;demande-header-card&quot;&gt;
                    &lt;div className=&quot;demande-id-statut&quot;&gt;
                      &lt;span className=&quot;demande-id&quot;&gt;Demande #{demande.id}&lt;/span&gt;
                      &lt;span className={`statut-badge ${badge.classe}`}&gt;
                        {getStatutIcon(demande.statut)} {badge.texte}
                      &lt;/span&gt;
                    &lt;/div&gt;
                    {demande.dateCreation ? (
                      &lt;span className=&quot;demande-date&quot;&gt;
                        Cr&eacute;&eacute;e le{&quot; &quot;}
                        {new Date(demande.dateCreation).toLocaleDateString()}
                      &lt;/span&gt;
                    ) : null}
                  &lt;/div&gt;

                  &lt;div className=&quot;demande-body&quot;&gt;
                    {/* Informations client (basique, faute de d&eacute;tails DB) */}
                    &lt;div className=&quot;client-info&quot;&gt;
                      &lt;h3&gt;üë§ Informations client&lt;/h3&gt;
                      &lt;div className=&quot;client-details&quot;&gt;
                        &lt;div className=&quot;client-detail&quot;&gt;
                          &lt;span className=&quot;detail-label&quot;&gt;Nom :&lt;/span&gt;
                          &lt;span className=&quot;detail-value&quot;&gt;
                            {demande.client.nom}
                          &lt;/span&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;

                    {/* Informations rendez-vous */}
                    &lt;div className=&quot;demande-info-row&quot;&gt;
                      &lt;div className=&quot;demande-info-item&quot;&gt;
                        &lt;span className=&quot;info-label&quot;&gt;Service&lt;/span&gt;
                        &lt;span className=&quot;info-value&quot;&gt;{demande.service}&lt;/span&gt;
                      &lt;/div&gt;
                      &lt;div className=&quot;demande-info-item&quot;&gt;
                        &lt;span className=&quot;info-label&quot;&gt;Technicien assign&eacute;&lt;/span&gt;
                        &lt;span className=&quot;info-value&quot;&gt;{demande.technicien}&lt;/span&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;div className=&quot;demande-info-row&quot;&gt;
                      &lt;div className=&quot;demande-info-item&quot;&gt;
                        &lt;span className=&quot;info-label&quot;&gt;Date du rendez-vous&lt;/span&gt;
                        &lt;span className=&quot;info-value&quot;&gt;
                          {new Date(demande.date).toLocaleDateString(&quot;fr-CA&quot;)}{&quot; &quot;}
                          {demande.heure !== &quot;&mdash;&quot; ? `&agrave; ${demande.heure}` : &quot;&quot;}
                        &lt;/span&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;

                    &lt;div className=&quot;demande-description&quot;&gt;
                      &lt;span className=&quot;info-label&quot;&gt;
                        Description du probl&egrave;me
                      &lt;/span&gt;
                      &lt;p&gt;{demande.description}&lt;/p&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
              );
            })}
          &lt;/div&gt;
        )}
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default Employe;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
