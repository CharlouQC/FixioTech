<html>
<head>
    <title>frontend/src/vues/login.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">frontend/src/vues/login.jsx (<b>118</b> lines of code) (<a href="login.jsx">raw</a>):</h3>
<div id="editor">import React, { useState } from &quot;react&quot;;
import { Link, useNavigate } from &quot;react-router-dom&quot;;
import &quot;./login.css&quot;;
import { loginUtilisateur } from &quot;../../services/apiUtilisateur&quot;;
import { useAuth } from &quot;../context/AuthContext.jsx&quot;;

const Login = () =&gt; {
  const navigate = useNavigate();
  const [formData, setFormData] = useState({
    courriel: &quot;&quot;,
    mot_de_passe: &quot;&quot;,
  });

  const [error, setError] = useState(&quot;&quot;);
  const [isLoading, setIsLoading] = useState(false);

  const { login } = useAuth();

  const handleChange = (e) =&gt; {
    setFormData((prev) =&gt; ({
      ...prev,
      [e.target.name]: e.target.value,
    }));
  };

  const handleSubmit = (e) =&gt; {
    e.preventDefault();
    setError(&quot;&quot;);

    if (!formData.courriel || !formData.mot_de_passe) {
      setError(&quot;Veuillez remplir tous les champs&quot;);
      return;
    }

    setIsLoading(true);

    loginUtilisateur(formData)
      .then((response) =&gt; {
        // Exemple de payload attendu :
        // { utilisateur: {...}, token?: &quot;...&quot; }
        const u = response?.utilisateur || response?.user || {};

        // Normalisation des champs cl&eacute;s
        const normalized = {
          ...u,
          id:
            u.id ?? u.client_id ?? u.utilisateur_id ?? u.id_utilisateur ?? null,
          role: ((u.role ?? u.type ?? &quot;&quot;) + &quot;&quot;).toLowerCase() || &quot;client&quot;,
          email: u.email ?? u.courriel ?? &quot;&quot;,
          nom_complet:
            u.nom_complet ??
            u.nom ??
            `${u.prenom ?? &quot;&quot;} ${u.nom_famille ?? &quot;&quot;}`.trim(),
        };

        // (Optionnel) stocker le token si fourni
        if (response?.token) {
          localStorage.setItem(&quot;auth_token&quot;, response.token);
        }

        // Injection dans le contexte
        login(normalized);

        // Redirection par r&ocirc;le (adapte aux routes existantes)
        switch (normalized.role) {
          case &quot;admin&quot;:
            navigate(&quot;/admin&quot;);
            break;
          case &quot;employe&quot;:
          case &quot;employ&eacute;&quot;:
            navigate(&quot;/employe&quot;);
            break;
          case &quot;client&quot;:
          default:
            navigate(&quot;/client&quot;);
            break;
        }
      })
      .catch((err) =&gt; {
        console.error(&quot;Erreur connexion:&quot;, err);
        setError(err?.message || &quot;Erreur lors de la connexion&quot;);
      })
      .finally(() =&gt; setIsLoading(false));
  };

  return (
    &lt;div className=&quot;login-container&quot;&gt;
      &lt;div className=&quot;login-box&quot;&gt;
        &lt;h2&gt;Connexion&lt;/h2&gt;
        {error &amp;&amp; &lt;div className=&quot;error-message&quot;&gt;{error}&lt;/div&gt;}

        &lt;form onSubmit={handleSubmit}&gt;
          &lt;div className=&quot;form-groupe&quot;&gt;
            &lt;label htmlFor=&quot;courriel&quot;&gt;Adresse courriel&lt;/label&gt;
            &lt;input
              type=&quot;email&quot;
              id=&quot;courriel&quot;
              name=&quot;courriel&quot;
              value={formData.courriel}
              onChange={handleChange}
              placeholder=&quot;Entrez votre adresse courriel&quot;
              autoComplete=&quot;email&quot;
            /&gt;
          &lt;/div&gt;

          &lt;div className=&quot;form-groupe&quot;&gt;
            &lt;label htmlFor=&quot;password&quot;&gt;Mot de passe&lt;/label&gt;
            &lt;input
              type=&quot;password&quot;
              id=&quot;password&quot;
              name=&quot;mot_de_passe&quot;
              value={formData.mot_de_passe}
              onChange={handleChange}
              placeholder=&quot;Entrez votre mot de passe&quot;
              autoComplete=&quot;current-password&quot;
            /&gt;
          &lt;/div&gt;

          &lt;button
            type=&quot;submit&quot;
            className=&quot;bouton-soumettre&quot;
            disabled={isLoading}
          &gt;
            {isLoading ? &quot;Connexion en cours...&quot; : &quot;Se connecter&quot;}
          &lt;/button&gt;
        &lt;/form&gt;

        &lt;p className=&quot;redirect-text&quot;&gt;
          Pas encore de compte ? &lt;Link to=&quot;/inscription&quot;&gt;Inscrivez-vous&lt;/Link&gt;
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default Login;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
