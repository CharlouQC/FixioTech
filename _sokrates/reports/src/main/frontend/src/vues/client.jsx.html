<html>
<head>
    <title>frontend\src\vues\client.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">frontend\src\vues\client.jsx (<b>146</b> lines of code) (<a href="client.jsx">raw</a>):</h3>
<div id="editor">import React, { useCallback, useEffect, useMemo, useState } from &quot;react&quot;;
import &quot;./client.css&quot;;
import { useAuth } from &quot;../context/AuthContext&quot;;
import { getRendezVousByClient } from &quot;../../services/apiRendezVous&quot;;
import { getEmployes } from &quot;../../services/apiUtilisateur&quot;;

const Client = () =&gt; {
  const { user } = useAuth();

  const [loading, setLoading] = useState(true);
  const [rdvs, setRdvs] = useState([]);
  const [error, setError] = useState(&quot;&quot;);
  const [employesMap, setEmployesMap] = useState({}); // { [id]: employ&eacute; }

  const fmtDate = useCallback((isoDate) =&gt; {
    if (typeof isoDate === &quot;string&quot; &amp;&amp; /^\d{4}-\d{2}-\d{2}$/.test(isoDate)) {
      return isoDate; // &eacute;vite les d&eacute;calages de fuseau
    }
    try {
      const d = new Date(isoDate);
      return Number.isNaN(d.getTime())
        ? String(isoDate ?? &quot;&quot;)
        : d.toLocaleDateString();
    } catch {
      return String(isoDate ?? &quot;&quot;);
    }
  }, []);

  const clientId =
    user?.id ??
    user?.client_id ??
    user?.utilisateur_id ??
    user?.id_utilisateur ??
    null;

  useEffect(() =&gt; {
    let cancelled = false;
    if (!clientId) {
      setLoading(false);
      setRdvs([]);
      setEmployesMap({});
      return;
    }

    (async () =&gt; {
      setLoading(true);
      setError(&quot;&quot;);
      try {
        const [rdvList, employes] = await Promise.all([
          getRendezVousByClient(clientId),
          getEmployes(),
        ]);

        if (cancelled) return;

        console.debug(&quot;[Client] clientId=&quot;, clientId, &quot;RDV re&ccedil;us=&quot;, rdvList);
        setRdvs(Array.isArray(rdvList) ? rdvList : []);

        const map = {};
        (Array.isArray(employes) ? employes : []).forEach((e) =&gt; {
          if (e?.id != null) map[e.id] = e;
        });
        setEmployesMap(map);
      } catch (err) {
        if (!cancelled) {
          console.error(&quot;[Client] Erreur chargement RDV:&quot;, err);
          setError(err?.message || String(err));
          setRdvs([]);
          setEmployesMap({});
        }
      } finally {
        if (!cancelled) setLoading(false);
      }
    })();

    return () =&gt; {
      cancelled = true;
    };
  }, [clientId]);

  const contenu = useMemo(() =&gt; {
    if (loading) {
      return (
        &lt;div className=&quot;client-loading&quot;&gt;Chargement de vos rendez-vous&hellip;&lt;/div&gt;
      );
    }
    if (error) {
      return &lt;div className=&quot;client-error&quot;&gt;{error}&lt;/div&gt;;
    }
    if (!rdvs.length) {
      return (
        &lt;div className=&quot;client-empty&quot;&gt;
          Vous n&rsquo;avez pas encore de rendez-vous.
        &lt;/div&gt;
      );
    }

    return (
      &lt;div className=&quot;client-rdv-liste&quot;&gt;
        {rdvs.map((r) =&gt; {
          const tech = employesMap[r.employe_id];
          const techLabel =
            tech?.nom_complet || tech?.email || `Technicien #${r.employe_id}`;

          return (
            &lt;div key={r.id} className=&quot;client-rdv-card&quot;&gt;
              &lt;div className=&quot;client-rdv-header&quot;&gt;
                &lt;div className=&quot;client-rdv-id&quot;&gt;RDV #{r.id}&lt;/div&gt;
                &lt;div
                  className={`client-statut-badge client-statut-${(
                    r.statut || &quot;Programm&eacute;&quot;
                  ).toLowerCase()}`}
                &gt;
                  {r.statut || &quot;Programm&eacute;&quot;}
                &lt;/div&gt;
              &lt;/div&gt;

              &lt;div className=&quot;client-rdv-body&quot;&gt;
                &lt;div className=&quot;client-rdv-row&quot;&gt;
                  &lt;div className=&quot;client-rdv-item&quot;&gt;
                    &lt;div className=&quot;label&quot;&gt;Date&lt;/div&gt;
                    &lt;div className=&quot;value&quot;&gt;{fmtDate(r.date_rdv)}&lt;/div&gt;
                  &lt;/div&gt;
                  &lt;div className=&quot;client-rdv-item&quot;&gt;
                    &lt;div className=&quot;label&quot;&gt;Heure&lt;/div&gt;
                    &lt;div className=&quot;value&quot;&gt;{r.heure_rdv || &quot;&mdash;&quot;}&lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;

                &lt;div className=&quot;client-rdv-row&quot;&gt;
                  &lt;div className=&quot;client-rdv-item&quot;&gt;
                    &lt;div className=&quot;label&quot;&gt;Technicien assign&eacute;&lt;/div&gt;
                    &lt;div className=&quot;value&quot;&gt;{techLabel}&lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;

                {r.description_probleme ? (
                  &lt;div className=&quot;client-rdv-desc&quot;&gt;
                    &lt;div className=&quot;label&quot;&gt;Description&lt;/div&gt;
                    &lt;p className=&quot;value&quot;&gt;{r.description_probleme}&lt;/p&gt;
                  &lt;/div&gt;
                ) : null}
              &lt;/div&gt;
            &lt;/div&gt;
          );
        })}
      &lt;/div&gt;
    );
  }, [loading, error, rdvs, employesMap, fmtDate]);

  return (
    &lt;div className=&quot;client-container&quot;&gt;
      &lt;div className=&quot;client-header&quot;&gt;
        &lt;h1&gt;Mes demandes&lt;/h1&gt;
        &lt;p className=&quot;client-intro&quot;&gt;
          Consultez ici vos rendez-vous demand&eacute;s et leur statut.
        &lt;/p&gt;
      &lt;/div&gt;

      {contenu}
    &lt;/div&gt;
  );
};

export default Client;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
