<html>
<head>
    <title>backend/app.js</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">backend/app.js (<b>57</b> lines of code) (<a href="app.js">raw</a>):</h3>
<div id="editor">import express from &quot;express&quot;;
import dotenv from &quot;dotenv&quot;;
import cors from &quot;cors&quot;;

import { assertDb, db } from &quot;./config/databaseConnexion.js&quot;;
import routerUtilisateur from &quot;./routes/routeUtilisateur.js&quot;;
import routerHoraire from &quot;./routes/routeHoraire.js&quot;;
import routerRendezVous from &quot;./routes/routeRendezVous.js&quot;;
import errorHandler from &quot;./middlewares/errorHandler.js&quot;;

dotenv.config();

const app = express();

// ---- CORS ----
const allowList = new Set([
  &quot;http://localhost:5173&quot;,
  process.env.FRONTEND_ORIGIN, // ex: https://ton-frontend.onrender.com
]);

app.use(
  cors({
    origin: (origin, cb) =&gt; {
      if (!origin) return cb(null, true); // outils CLI, Postman
      if (allowList.has(origin) || origin.endsWith(&quot;.onrender.com&quot;))
        return cb(null, true);
      return cb(new Error(&quot;Not allowed by CORS&quot;));
    },
    credentials: true,
  })
);

// ---- Middlewares / routes ----
app.use(express.json());

app.get(&quot;/health&quot;, async (_req, res) =&gt; {
  try {
    await assertDb();
    res.status(200).send(&quot;OK&quot;);
  } catch {
    res.status(500).send(&quot;DB DOWN&quot;);
  }
});

app.use(&quot;/api/utilisateurs&quot;, routerUtilisateur);
app.use(&quot;/api/horaires&quot;, routerHoraire);
app.use(&quot;/api/rendezVous&quot;, routerRendezVous);

app.get(&quot;/test-db&quot;, async (_req, res) =&gt; {
  try {
    const result = await new Promise((resolve, reject) =&gt; {
      db.query(&quot;SELECT NOW()&quot;, (err, r) =&gt; {
        if (err) reject(err);
        else resolve(r);
      });
    });

    const now = result.rows[0].now;
    res.status(200).send(`Database OK &mdash; NOW() = ${now}`);
  } catch (error) {
    res.status(500).send(`Database ERROR &mdash; ${error.message}`);
  }
});

app.use(errorHandler);

// ---- Lancement ----
const PORT = process.env.PORT || 3000;
app.listen(PORT, () =&gt; {
  console.log(`API &eacute;coute sur le port ${PORT}`);
});

export default app;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/javascript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
