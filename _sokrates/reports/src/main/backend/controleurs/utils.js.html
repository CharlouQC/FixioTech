<html>
<head>
    <title>backend/controleurs/utils.js</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">backend/controleurs/utils.js (<b>33</b> lines of code) (<a href="utils.js">raw</a>):</h3>
<div id="editor">/**
 * &Agrave; partir d'une date ISO (YYYY-MM-DD), retourne les noms de colonnes
 * d'horaire &agrave; utiliser (lundi_debut, lundi_fin, etc.).
 */
export function colonnesJour(dateISO) {
  // 0 = dimanche .. 6 = samedi
  const j = new Date(`${dateISO}T00:00:00`).getDay();
  const noms = [
    &quot;dimanche&quot;,
    &quot;lundi&quot;,
    &quot;mardi&quot;,
    &quot;mercredi&quot;,
    &quot;jeudi&quot;,
    &quot;vendredi&quot;,
    &quot;samedi&quot;,
  ];
  const jour = noms[j];
  return { debutCol: `${jour}_debut`, finCol: `${jour}_fin` };
}

/**
 * Base commune de la requ&ecirc;te qui trouve les employ&eacute;s disponibles
 * pour un cr&eacute;neau donn&eacute; (date + heure).
 *
 * @param {string} debutCol  ex: &quot;lundi_debut&quot;
 * @param {string} finCol    ex: &quot;lundi_fin&quot;
 * @param {string} selectColumns  ex: &quot;u.id&quot; ou &quot;u.id, u.email, ...&quot;
 */
export function baseDisponibiliteQuery(
  debutCol,
  finCol,
  selectColumns = &quot;u.id, u.email, u.nom_complet, u.role&quot;
) {
  return `
    SELECT ${selectColumns}
    FROM utilisateurs u
    JOIN horaires h ON h.employe_id = u.id
    LEFT JOIN rendez_vous r
      ON r.employe_id = u.id AND r.date_rdv = $1 AND r.heure_rdv = $2
    WHERE u.role = 'employe'
      AND h.${debutCol} IS NOT NULL
      AND h.${finCol}   IS NOT NULL
      AND h.${debutCol} &lt;= $3
      AND $4 &lt; h.${finCol}
      AND r.id IS NULL
  `;
}</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/javascript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
